<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electron Browser AI</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="floating-button/button.css">
</head>
<body>
    <!-- 主要内容区域 -->
    <div id="main-container">
        <!-- 顶部工具栏 -->
        <div id="toolbar">
            <div class="toolbar-section">
                <h1>Electron Browser AI</h1>
                <p>智能浏览器助手 - 自动生成页面使用说明</p>
            </div>
            
            <div class="toolbar-section">
                <button id="ai-chat-btn" class="toolbar-btn">🤖 AI助手</button>
                <button id="debug-btn" class="toolbar-btn">🔍 调试</button>
                <button id="settings-btn" class="toolbar-btn">设置</button>
                <button id="help-btn" class="toolbar-btn">帮助</button>
            </div>
        </div>

        <!-- 浏览器区域 -->
        <div id="browser-container">
            <div id="address-bar">
                <input type="url" id="url-input" placeholder="输入网址或搜索内容..." value="https://www.baidu.com">
                <button id="go-btn">访问</button>
                <button id="refresh-btn">刷新</button>
                <button id="reset-webview-btn" title="重置WebView">🔧</button>
            </div>
            
            <div id="browser-content">
                <webview id="webview"
                         src="https://www.baidu.com"
                         style="width: 100%; height: 100%;"
                         nodeintegration="false"
                         webpreferences="contextIsolation=true,webSecurity=false,sandbox=false,javascript=true,plugins=false,images=true"
                         allowpopups="false"
                         disablewebsecurity="true"
                         partition="persist:webview">
                </webview>
            </div>
        </div>

        <!-- 状态栏 -->
        <div id="status-bar">
            <span id="status-text">就绪</span>
            <span id="ai-status">AI: 未连接</span>
            <span id="mcp-status">MCP: 检查中...</span>
            <span id="python-status">Python: 检查中...</span>
        </div>
    </div>

    <!-- 悬浮按钮 -->
    <div id="floating-button" class="floating-btn">
        <span class="btn-icon">🤖</span>
        <span class="btn-text">生成说明</span>
    </div>

    <!-- 设置面板 -->
    <div id="settings-panel" class="panel hidden">
        <div class="panel-header">
            <h3>设置</h3>
            <button id="close-settings" class="close-btn">&times;</button>
        </div>
        
        <div class="panel-content">
            <div class="setting-group">
                <h4>AI模型配置</h4>

                <label for="api-type">API类型:</label>
                <select id="api-type">
                    <option value="doubao">豆包 (推荐)</option>
                    <option value="ollama">Ollama</option>
                    <option value="openai">OpenAI</option>
                </select>

                <label for="model-url">模型服务地址:</label>
                <input type="text" id="model-url" value="https://ark.cn-beijing.volces.com/api/v3" placeholder="https://ark.cn-beijing.volces.com/api/v3">

                <label for="api-key">API密钥:</label>
                <input type="password" id="api-key" value="0bf1c076-b6e9-479a-9c55-051813ad5e4a" placeholder="请输入API密钥">

                <label for="model-name">模型名称:</label>
                <select id="model-name">
                    <option value="doubao-seed-1-6-250615">豆包-Seed-1.6 (支持图片分析，推荐)</option>
                    <option value="doubao-1-5-thinking-pro-250415">豆包-1.5-thinking-pro</option>
                    <option value="llama2">Llama 2</option>
                    <option value="codellama">Code Llama</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                    <option value="gpt-4">GPT-4</option>
                    <option value="gpt-4-vision-preview">GPT-4 Vision</option>
                </select>

                <button id="test-connection">测试连接</button>
                <span id="connection-status"></span>
            </div>
            
            <div class="setting-group">
                <h4>功能选项</h4>
                <label>
                    <input type="checkbox" id="auto-screenshot" checked>
                    自动截图
                </label>
                <label>
                    <input type="checkbox" id="include-css" checked>
                    包含CSS样式
                </label>
                <label>
                    <input type="checkbox" id="include-js" checked>
                    包含JavaScript代码
                </label>
            </div>
        </div>
    </div>

    <!-- 文档显示面板 -->
    <div id="documentation-panel" class="panel hidden">
        <div class="panel-header">
            <h3>页面使用说明</h3>
            <div class="panel-actions">
                <button id="save-doc" class="action-btn">保存</button>
                <button id="copy-doc" class="action-btn">复制</button>
                <button id="close-doc" class="close-btn">&times;</button>
            </div>
        </div>
        
        <div class="panel-content">
            <div id="documentation-content">
                <div class="loading hidden" id="doc-loading">
                    <div class="spinner"></div>
                    <p>AI正在分析页面内容，请稍候...</p>
                </div>
                <div id="doc-text"></div>
            </div>
        </div>
    </div>

    <!-- 帮助面板 -->
    <div id="help-panel" class="panel hidden">
        <div class="panel-header">
            <h3>使用帮助</h3>
            <button id="close-help" class="close-btn">&times;</button>
        </div>
        
        <div class="panel-content">
            <div class="help-content">
                <h4>如何使用</h4>
                <ol>
                    <li>在地址栏输入要访问的网址</li>
                    <li>点击右下角的"生成说明"按钮</li>
                    <li>AI将自动分析页面内容并生成使用说明</li>
                    <li>可以保存或复制生成的说明</li>
                </ol>
                
                <h4>功能特性</h4>
                <ul>
                    <li>自动提取页面HTML、CSS、JavaScript代码</li>
                    <li>智能截图功能</li>
                    <li>AI驱动的使用说明生成</li>
                    <li>支持Windows自动化操作（MCP）</li>
                </ul>
                
                <h4>系统要求</h4>
                <ul>
                    <li>Windows 10/11</li>
                    <li>本地AI模型服务（如Ollama）</li>
                    <li>网络连接</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- AI智能助手侧边栏 -->
    <div id="ai-sidebar" class="ai-sidebar hidden">
        <!-- 侧边栏头部 -->
        <div class="sidebar-header">
            <div class="header-content">
                <div class="ai-avatar">
                    <div class="avatar-icon">🤖</div>
                    <div class="status-indicator online"></div>
                </div>
                <div class="header-text">
                    <h3>AI智能助手</h3>
                    <span class="status-text">在线 · 随时为您服务</span>
                </div>
            </div>
            <div class="header-actions">
                <button id="minimize-sidebar" class="header-btn" title="最小化">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 13H5v-2h14v2z"/>
                    </svg>
                </button>
                <button id="close-sidebar" class="header-btn" title="关闭">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- 对话区域 -->
        <div class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <div class="welcome-message">
                    <div class="welcome-icon">✨</div>
                    <h4>欢迎使用AI智能助手</h4>
                    <p>我可以理解您的自然语言指令，并在指定时间自动执行浏览器操作。</p>
                    <div class="quick-examples">
                        <div class="example-item" onclick="insertExample(this.textContent)">
                            💡 明天上午10点搜索今天的新闻
                        </div>
                        <div class="example-item" onclick="insertExample(this.textContent)">
                            💡 下午3点提醒我查看邮箱
                        </div>
                        <div class="example-item" onclick="insertExample(this.textContent)">
                            💡 晚上8点用百度搜索天气
                        </div>
                    </div>
                </div>
            </div>

            <!-- 输入区域 -->
            <div class="chat-input-area">
                <div class="input-container">
                    <textarea id="chat-input" placeholder="输入您的指令，支持任意自然语言..." rows="1"></textarea>
                    <button id="send-chat" class="send-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
                <div class="input-actions">
                    <button id="clear-chat" class="action-btn">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                        </svg>
                        清空对话
                    </button>
                    <span class="input-hint">支持任意自然语言表达</span>
                </div>
            </div>
        </div>

        <!-- 任务管理区域 -->
        <div class="tasks-section">
            <div class="section-header" id="tasks-header">
                <div class="header-left">
                    <h4>📅 智能任务</h4>
                    <span class="task-count" id="task-count">0</span>
                </div>
                <button class="collapse-btn" id="collapse-tasks" title="折叠/展开任务列表">
                    <svg class="collapse-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
                    </svg>
                </button>
            </div>
            <div id="tasks-list" class="tasks-list">
                <div class="no-tasks">
                    <div class="empty-icon">📋</div>
                    <p>还没有任务</p>
                    <span>快来创建第一个智能任务吧！</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 侧边栏遮罩 -->
    <div id="sidebar-overlay" class="sidebar-overlay hidden"></div>

    <!-- 调试面板 -->
    <div id="debug-panel" class="panel hidden">
        <div class="panel-header">
            <h3>🔍 AI调试信息</h3>
            <div class="panel-actions">
                <button id="clear-debug" class="action-btn">清空</button>
                <button id="export-debug" class="action-btn">导出</button>
                <button id="close-debug" class="close-btn">&times;</button>
            </div>
        </div>

        <div class="panel-content">
            <div id="debug-content">
                <div class="debug-section">
                    <h4>📤 请求信息</h4>
                    <div id="debug-request" class="debug-info">
                        <div class="debug-placeholder">等待API请求...</div>
                    </div>
                </div>

                <div class="debug-section">
                    <h4>📥 响应信息</h4>
                    <div id="debug-response" class="debug-info">
                        <div class="debug-placeholder">等待API响应...</div>
                    </div>
                </div>

                <div class="debug-section">
                    <h4>📊 统计信息</h4>
                    <div id="debug-stats" class="debug-info">
                        <div class="debug-placeholder">等待统计数据...</div>
                    </div>
                </div>

                <div class="debug-section">
                    <h4>📝 调试日志</h4>
                    <div id="debug-logs" class="debug-logs">
                        <div class="debug-placeholder">等待调试日志...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知容器 -->
    <div id="notifications"></div>

    <!-- 脚本文件 -->
    <script src="utils/nlp-parser.js"></script>

    <!-- 🆕 通用自动化模块 -->
    <script src="automation/command-parser.js"></script>
    <script src="automation/element-finder.js"></script>
    <script src="automation/vision-analyzer.js"></script>
    <script src="automation/hybrid-element-finder.js"></script>
    <script src="automation/action-executor.js"></script>
    <script src="automation/automation-engine.js"></script>

    <script src="utils/task-scheduler.js"></script>
    <script src="utils/ai-chat.js"></script>
    <script src="index.js"></script>
    <script src="floating-button/button.js"></script>
    <script src="utils/extract.js"></script>
    <script src="utils/capture.js"></script>
    <script src="utils/display.js"></script>
    <script src="utils/debug.js"></script>
</body>
</html>
